<?php# Отслеживание посылок# $track_id - трек# $id_track - ID трека в БД# $id_custom - ID заказа в БД# Отслеживание посылок с помощью прямого запроса к сервисам Почты Россииif ($config['track']['provider'] == 'RussianPost'){	include_once dirname(__FILE__) . '/M_TrackRussianPostNew.inc.php';	$get_track = getOperationHistory($track_id, $config['track']['login'], $config['track']['password']);	$track_types = $track_operations = array();	if (is_array($get_track))	{		foreach ($get_track as $key => $tr)		{			$date = $tr['date'];			$date = substr($date, 0, 10);			list($y, $m, $d) = explode('-', $date);						$track_data[$id][$key]['id_track'] = $id_track;			$track_data[$id][$key]['date'] = $d . '.' . $m . '.' . $y;			$track_data[$id][$key]['status'] = $tr['status'];			$track_data[$id][$key]['operation'] = $tr['operation'];			$track_data[$id][$key]['place'] = $tr['place'];			$track_status = $tr['status'];			$track_types[] = $tr['status'];			$track_operations[] = $tr['operation'];		}	}	else	{		$track['id'] = $track_id;		$track_status = 'Ошибка';	}}# Отслеживание посылок с помощью прямого запроса к сервисам Новой Почтеelseif ($config['track']['provider'] == 'NewPost'){	include_once dirname(__FILE__) . '/M_NewPost.inc.php';	$mNewPost = M_NewPost::Instance();		$get_track = $mNewPost->GetTrackData($track_id, $config['track']['api_key']);		if (is_object($get_track))	{		$track_data[$id][0] = array(			'id_track' => $id_track,			'status' => $get_track->data[0]->StateId,			'operation' => $get_track->data[0]->StateName,			'date' => $get_track->data[0]->DateReceived,			'place' => (!empty($get_track->data[0]->CityReceiverUA)) ? $get_track->data[0]->CityReceiverUA .', '. $get_track->data[0]->AddressUA : ''		);		$track_status = $get_track->data[0]->StateName;		$track_types[] = $get_track->data[0]->StateName;	}	else	{		$track['id'] = $track_id;		$track_status = 'Ошибка';	}}