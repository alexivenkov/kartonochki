+++Инструкция по использованию скрипта для приёма заказов jSale 1.431+++
<?

Разработчик скрипта Алексей Опанасенко: http://neverlex.com
Сайт проекта: http://jsale.biz

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
1. Установка:

Шаг 1. Загружаем содержимое дистрибутива на сервер. Рабочая папка скрипта jsale/. Остальные файлы для образца.

Шаг 2. Для настройки правим в текстовом редакторе файл jsale/config.inc.php. Там находятся все настройки и подключение модулей. Всё подробно откомментировано.
Рекомендуется использовать редактор NotePad++.

Прежде всего нужно выставить:

адрес сайта		- $config['sitelink']
email адреса	- $config['email']['receiver'] и $config['email']['answer']
настройки БД	- $config['database']['host'], $config['database']['user'], $config['database']['pass'], $config['database']['name']

==============================================================================

Шаг 3. Вставляем в место вывода кнопки заказа код:

Вариант 3.1 Если данные товара сохранены в настройках (раздел НАСТРОЙКА ПОЛЕЙ ТОВАРА), то задавать дополнительно их не нужно. Самый простой вариант.
<script src="jsale/JS.php" type="text/javascript"></script>

Вариант 3.2 Если нужно использовать несколько товаров, то параметры товара (идентификатор, название, цену, единицу измерения, количество) следует задавать в виде GET параметров.
<script src="jsale/JS.php?id=001&title=Товар 1&price=10.00&qty=1&unit=кг" type="text/javascript"></script>

Вариант 3.3 Также можно использовать дополнительные параметры ($param1, param2, param3). Сохранять в них можно, что угодно. Например, цвет, размер и т.д.
<script src="jsale/JS.php?id=001&title=Товар 1&price=10.00&qty=1&param1=Красный&param2=XL&param3=Что-то ещё" type="text/javascript"></script>

Вариант 3.4 Рядом с кнопкой можно вывести описание товара. Эта информация используется только для отображения. Или же можно перенести описание в форму заказа.
<script src="jsale/JS.php?id=001&title=Товар 1&price=10.00&description=<p>Краткое описание товара.</p>" type="text/javascript"></script>

Вариант 3.5 Для того, чтобы предоставить (или нет) ввод количества, нужно использовать параметр qty_type. Чтобы вывести поле, выставьте qty_type=text. Чтобы не выводить поле для ввода количества, qty_type=0. 
<script src="jsale/JS.php?qty_type=text" type="text/javascript"></script>

Вариант 3.6 Для того, чтобы предоставить покупателю процентную скидку, используйте параметр discount. 
<script src="jsale/JS.php?discount=10" type="text/javascript"></script>

Вариант 3.7 Использование различных шаблонов, методов вывода формы и надписи на кнопке.
Пример: <script src="jsale/JS.php?template=2&form_type=button&button_text=Заказать" type="text/javascript"></script>
где
template - название или номер шаблона [подробнее в пункте 4.3]
form_type - метод вывода на экран (простая форма ИЛИ кнопка + форма в модальном окне) [подробнее в пункте 4.4]
button_text - текст на кнопке

=============================================================================

Шаг 4. Создание таблиц в БД.

	Если данные подключения к MySQL в настройках прописаны верно, то после первого открытия страницы с кнопкой заказа или админки в БД будут созданы таблицы.
	После этого файл jsale/install.inc.php должен быть автоматически удалён. Если этого не произошло, удалите его вручную.

=============================================================================
	
Шаг 5. Для изменения оформления правим файл jsale/css/jsale.css

	Кнопка: .jSaleButton
	Форма: .jSaleForm
	Модальное окно: #simplemodal-container
	
	ВНИМАНИЕ! Нельзя удалять класс .jSaleOrder с кнопки заказа, .jSaleForm с формы, .jSaleSubmit с кнопки отправки заказа, .jSaleQty с поля количества, .jSaleCode с поля промо-кода. Эти классы используются как маркеры для обработок.

=============================================================================
	
Шаг 6. По надобности правим шаблоны в папке design/.

	Основные шаблоны:
	
	Шаблоны вывода товаров:
	-----------------------
	Шаблон вывода кнопки заказа - design/orderButton.tpl.php
	Шаблон вывода формы заказа - design/orderForm.tpl.php
	
	Шаблоны писем:
	--------------
	Шаблон письма заказа - design/emailOrder.tpl.php
	Шаблон письма об изменении статуса заказа - design/emailChangeStatus.tpl.php
	
=============================================================================
	
Шаг 7. Заходим в админку (jsale/admin/) и работаем в обычном режиме.
	По умолчанию логин/пароль: demo/demo.

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

2. Бонусы:

Бонус 1. В Базовой версии jSale внедрена Форма обратной связи. Для вставки формы используйте код:
<script src="jsale/JS.php?feedback" type="text/javascript"></script>

Все необходимые настройки находятся в файле config.inc.php.

Бонус 2. Скрипт для exit-трафика находится в папке exit/. Смотрите пример в файле index.html и модифицируйте.
Этот бонус доступен начиная с Базовой версии.

Бонус 3. На скрипте модального окна simplemodal.js построена jSale. Он бесплатен.
Находится в папке js/jquery.simplemodal.1.4.2.min.js. Сайт разработчика: http://www.ericmmartin.com/projects/simplemodal/

Пользуйтесь.

Бонус 4. В Продвинутой версии скрипта зашита массовая проверка треков почты России.
Можете просто задать список треков (каждый с новой строки) и получить информацию о них в виде таблицы.

Чтобы включить в меню массовую проверку треков, уберите символы /* и */ в строках 
/* if (is_file(dirname(__FILE__) . '/masscheck.php'))
		array_push ($menu_items,
			array ('masscheck', 'Массовая проверка', 'Масовая проверка треков Почты России')
		); */

файла jsale/admin/_menu.php

Бонус #5. В Цифровой версии jSale внедрена Форма заказа обратного звонка. Для вставки формы используйте код:
<script src="jsale/JS.php?call" type="text/javascript"></script>

Все необходимые настройки находятся в файле config.inc.php.

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

3. Вопросы:

3.1. У меня сайт в кодировке windows-1251. Что делать?
Шаг 1. Установить в jsale/config.inc.php настройку $config['encoding'] = 'windows-1251';
Шаг 2. Перекодировать все файлы скрипта. Можете сделать это вручную с помощью редактора Notepad++.
Либо с помощью вспомогательно скрипта.

Для этого скопируйте папку scripts/ в папку со скриптом jsale/.
Откройте файл encoding.php редактором, раскоментируйте код (уберите "/*" после php) и откройте файл в браузере (путь должен быть такой http://domain.ru/jsale/scripts/encoding.php
ВНИМАНИЕ!!! ОТКРЫВАТЬ ЭТОТ ФАЙЛ НУЖНО ТОЛЬКО ОДИН РАЗ!!! Повторный запуск скрипта уничтожит данные.

Затем ОБЯЗАТЕЛЬНО удалите папку scripts/ с сервера.

ОБЯЗАТЕЛЬНО сделайте бэкап данных перед запуском скрипта!!!
При некорректном переносе, загрузите в БД старые данные и обращайтесь на info@jsale.biz

3.2. Как использовать скрипт для приёма заказов с нескольких сайтов?
В файле config.inc.php отыщите строку #$config['sites']	
Во-первых, раскомментируйте строку (уберите символ решётки # в начале строки).
Во-вторых, внесите в массив все домены и поддомены, под которыми должен работать скрипт. Без http:// и слеша (/) на конце.

Должно получиться примерно так:
$config['sites'] = array ('jsale.biz', 'demo.jsale.biz', 'neverlex.com'); # Домены сайтов, где будет также работать скрипт. Закомментировать, если не нужно.

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

4. Дополнительные возможности:

4.1. Для генерации корректных отчётов, обязательно корректно заполните раздел НАСТРОЙКИ ОТЧЁТОВ.
4.2. Для вывода бланков на печать, правьте НАСТРОЙКИ ПЕЧАТИ БЛАНКОВ. Во-первых, разрешите печать. Во-вторых, заполните необходимую информацию.
Шаблоны бланков: jsale/design/printForm1.tpl.php и jsale/design/printForm2.tpl.php
4.3. Использование разных шаблонов.

Нужно создать шаблон и прописать его в GET параметре.
Создаём файл design/orderForm_2.tpl.php, где 2 - идентификатор шаблона. Имя шаблона должно идти после подчёркивания.
При вставке кода на страницу, добавляем параметр template=2

Пример:
<script src="jsale/JS.php?template=2" type="text/javascript"></script>
Если template не указан, то будет использован шаблон design/orderForm.tpl.php.

4.4. Вывод формы разным методами.
Сейчас есть 2 варианта вывода формы: в модальном окне по клику кнопки и обычный вывод на страницу.

Метод вывода по умолчанию вы можете выставить в файле настроек config.inc.php
$config['product']['form_type']				= 'button'; # 2 варианта вывода формы: form или button

Соответственно, form - вывод обычной формой, button - вывод кнопкой.
Метод вывода можно задать конкретной форме с помощью добавления GET параметра form_type=form

Пример:
<script src="jsale/JS.php?form_type=form" type="text/javascript"></script>

4.5. Настройка автоматической оплаты с помощью агрегатора.
Всё довольно просто.
Регистрируетесь на сайте агрегатора, создаёте магазин, вводите все необходимые данные, в ResultURL (обработчик запроса) прописываете ссылку http://вашсайт.ru/jsale/modules/C_Payment.php. Метод POST.
Тогда после оплаты заказ будет автоматически изменять статус на Оплаченный.

4.6. Обновление цифровых товаров.
Встройте в нужное место страницы ссылку вида http://вашсайт.ru/jsale/update/id_товара/
, где id_товара - идентификатор вашего товара (код).
Или можете встроить ссылку прямо в шаблон вывода кнопки/формы.

4.7. Партнёрская программа.
Чтобы учитывать клики, разместите на страницах вашего сайта (в самом начале до вывода контента) код подключения файла C_Partner.inc.php
Например: <?php include_once dirname(__FILE__) . '/jsale/modules/C_Partner.inc.php'; ?>

Чтобы учитывать клики и UTM метки на странице другого домена, нужно подключить файл.
<script type="text/javascript" src="jsale/cookies.php<? if (isset($_GET)): ?>?<? foreach($_GET as $var => $val):?>&<?=$var?>=<?=$val?><? endforeach; ?><? endif; ?>"></script>
Естественно, страница должна обрабатываться интерпретатором PHP.

4.8. Автоматические уведомления.
Чтобы настроить автоматические уведомления, нужно выставить соответствующие настройки в config.inc.php, а затем в CRON поставить выполнение URL http://site.ru/jsale/modules/C_Notices.php?secret=$config['secretWord'] с периодичностью в 1 сутки

4.9. Дополнительные поля.
Дополнительные поля можно добавлять с помощью настройки файла config.inc.php в соответствующем разделе ДОПОЛНИТЕЛЬНЫЕ ПОЛЯ.
Поля могут быть 3 типов: select, checkbox, input. Также могут иметь надбавку к стоимости товара. Также могут быть обязательными.

4.10. Работа с авторами.
Чтобы учитывать авторские гонорары за продажи товаров, включите работу с авторами в файле config.inc.php. Строка: $config['author']['enabled']	= true;
Затем вы сможете добавлять новых авторов в админке и закреплять за ними товары. Кабинет автора находится по адресу: http://вашсайт.ru/jsale/author/

4.11. Работа с менеджерами.
Чтобы учитывать комиссионные менеджеров за обработку заказов, включите работу с менеджерами в файле config.inc.php. Строка: $config['manager']['enabled']	= true;
Затем вы сможете добавлять новых менеджеров в админке и закреплять за ними товары. Кабинет менеджера находится по адресу: http://вашсайт.ru/jsale/admin/ Это та же админка, только ограниченная по функциональности.
Есть 2 варианта начисления комиссии: product - все заказы привязанного к менеджеру товара, order - все обработанные менеджером заказы (за менеджером закрепляется заказ после первого редактирования).
Изменить тип можно переменной $config['manager']['type'].

4.12. Таргетинг.
Включите работу с таргетингом в файле config.inc.php и настройте подходящие источники трафика, а также пропишите URL для возврата.
Также на странице (в самом начале до вывода контента) разместите код подключения файла C_Targeting.inc.php
Например, <?php include_once dirname(__FILE__) . '/jsale/modules/C_Targeting.inc.php'; ?>

4.13. Работа с параметрами товара.
Для начала в файле config.inc.php активируйте опцию (значение $config['params']['enabled']) и выставьте необходимые настройки.
Затем в панели администратора создайте товар и при последующем редактировании добавьте его параметры. При добавлении параметра укажите: Название (оно будет выведено в форме, письмах и т.д.), ID (уникальный идентификатор на латинице), тип (выбор [выбор 1 из многих], флажки [выбор многие из многих], выключатель [2 варианта]), родитель (если нужно), обязательный или нет (без указания этого параметра форма отправлена не будет).

Затем добавляем варианты. Вначале добавляем нужное количество вариантов. Для этого нажимаем «Добавить» (возле текущего параметра) нужное количество раз. Затем вписываем данные вариантов (название, наценка, выбираем файл отображения). Затем нажимаем «Сохранить» (возле текущего параметра). Внимание! Будут сохранены только варианты выбранного параметра.

Также можно редактировать характеристики параметра. И изменять порядок вывода. Нельзя только изменить идентификатор и название.

4.14. Зависимость метода доставки от метода оплаты.
Настраивается в файле config.inc.php. Вначале нужно включить эту опцию $config['payment2delivery']['enabled'], а затем прописать массивом идентификаторы методов доставки, доступные для метода оплаты. Каждая новая строка - новый метод оплаты.

Например:
$config['payment2delivery']['email'] 		= array('1'); # Пропишите идентификаторы методов доставки в массиве
Т.е. для метода оплаты email (наложенный платёж) возможен только один вариант доставки (доставка почтой).

Если для одного из методов оплаты ограничений нет, то и прописывать ничего не нужно.

4.15. Работа с API. [Только для опытных пользователей!]
Смотрите пример использования в файле test_api.php. Отправляете данные методом POST, получаете ответ в XML.
Обязательно в файле config.inc.php измените значение $config['api']['key'] и активируйте работу опции $config['api']['enabled'].

4.16. Отдельные CSS и config файлы для товара. [Только для опытных пользователей!]
Устанавливается с помощью дополнительных GET параметров. Используйте только цифры.

Например, <script src="jsale/JS.php&css=3&config=3" type="text/javascript"></script>
означает, что для формы будут подключены дополнительные файлы css/jsale3.css и config3.inc.php

Вам нужно создать эти файлы и переопределить в них какие-то настройки или оформление.

4.17. Интеграция с сервисом рассылок SmartResponder.ru.
Активируйте в файле config.inc.php опцию ($config['smart']['enabled']) и пропишите необходимые настройки (ID API и ключ API - взять в аккаунте SmartResponder https://smartresponder.ru/l_ru/user/account_settings.html, а также идентификаторы рассылки, группы, канала - взять в настройках рассылки, группы, канала).

Email клиента, который оплатил заказ, будет автоматически добавлен в рассылку, группу, канал. Если данный email уже присутствует в вашей базе на СмартРеспондере, то добавление произойдёт моментально. В другом случае на email будет выслано активационное письмо.

4.18. Расчёт стоимости доставки EMS.
Вначале нужно включить этот метод доставки в файле настроек. Выставить значение $config['deliveries']['99']['enabled'] = true;
Затем настроить в $config['deliveries']['99']['from'] идентификатор пункта отправления. Взять можно здесь http://emspost.ru/api/rest/?method=ems.get.locations&type=russia&plain=true Придётся искать на странице с помощю поиска (Ctrl+F). Обратите внимание, что выводятся и города и регионы.
А также вес посылки $config['deliveries']['99']['weigth'] и тип отправления $config['deliveries']['99']['type'].
Обратите внимание, что для расчёт обязательно долджен быть введён индекс.
Если понадобится расчёт стоимости доставки для разных товаров с разным весом обратитесь к разработчику.

4.19. Автоматическое открытие модальной формы.
Чтобы форма открылась в модальном окне сразу после загрузки страницы, нужно добавить GET параметр open_modal.
Как вариант, можно управлять открытием окна с помощью GET параметра. В таком случае код будет выглядеть так:
<script src="jsale/JS.php?product=01&form_type=button<?=(isset($_GET['open_modal']))?'&open_modal':''?>" type="text/javascript"></script>
Пример: http://jsale.biz/demo/?open_modal

+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Подключение работающего скрипта геотаргетинга с подменой текста в зависимости от региона в форме Jsale orderForm.tpl.php

Скрипт нужно размещать в шаблоне формы И на странице, где размещена форма! 
На странице нужно добавлять сам скрипт, без слоев и спанов.
На странице необходимо подключение Jquery.

Скрипт подмены 1 текстового элемента на форме заказа

Скрипт для размещения в шаблоне:
	<!-- Скрипт подмены текста в зависимости от геолокации -->  
	<script charset="utf-8" src="http://api-maps.yandex.ru/1.1/index.xml?key=ABXRX1cBAAAA7dJyOgIA5RMaKGCI6BB7tjHYw4pQJFXsqXgAAAAAAAAAAADWQmsR13U8cKIvt2coqEQPm044fQ==" type="text/javascript"></script>	  
	<div class="free-delivery-wrapper">
		<div class="free-delivery-text">&gt;&gt;&gt; При заказе от 3 штук привезем бесплатно! &lt;&lt;&lt;</div>
	</div>		  
	<script type="text/javascript">
	$(document).ready(function() {
	if (YMaps.location.city != '') {
		$('.country span').html(YMaps.location.country);
		$('.region span').html(YMaps.location.region);
		var youCity = (YMaps.location.city);
		if (youCity === "Уфа"){
			$('.free-delivery-text').text('Ого! По Уфе доставка курьером БЕСПЛАТНО!');
		 }
		$('.city').html(YMaps.location.city);
	}
	});
	</script>

Скрипт для размещения на странице:
	<script charset="utf-8" src="http://api-maps.yandex.ru/1.1/index.xml?key=ABXRX1cBAAAA7dJyOgIA5RMaKGCI6BB7tjHYw4pQJFXsqXgAAAAAAAAAAADWQmsR13U8cKIvt2coqEQPm044fQ==" type="text/javascript"></script>	  
	
	<script type="text/javascript">
	$(document).ready(function() {
	if (YMaps.location.city != '') {
		$('.country span').html(YMaps.location.country);
		$('.region span').html(YMaps.location.region);
		var youCity = (YMaps.location.city);
		if (youCity === "Уфа"){
			$('.free-delivery-text').text('Ого! По Уфе доставка курьером БЕСПЛАТНО!');
		 }
		$('.city').html(YMaps.location.city);
	}
	});
	</script>
	
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

Вопросы и предложения можно отправлять на lexnevermind@gmail.com

Спасибо за приобретение отличного скрипта для приёма заказов jSale!

Отзыв отправьте на почту и он будет опубликован на оф.сайте со ссылкой на ваш проект.